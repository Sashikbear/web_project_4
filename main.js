!function(){"use strict";class e{constructor(e,t){this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}_resetForm(){this._inputList.forEach((e=>{this._hideInputError(e)}))}resetValidation(){this._toggleButtonState(),this._resetForm()}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class s{constructor(e,s,r){let{data:n,handleCardClick:i,handleDeleteCard:o,handleLikeButton:a}=e;t(this,"removeCardFromDOM",(()=>{this._element.remove(),this._element=null})),t(this,"handleLikeCard",(e=>{this._likes=e,this._likesCount.textContent=this._likes.length,this._likeButton.classList.toggle("button_active")})),this._name=n.name,this._link=n.link,this._id=n._id,this._ownerId=n.owner._id,this._userId=r,this._likes=n.likes,this._cardSelector=s,this._handleCardClick=i,this._handleLikeButton=a,this._handleDeleteCard=o,this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".button_type_like"),this._deleteButton=this._element.querySelector(".button_type_delete"),this._cardImage=this._element.querySelector(".card__image"),this._cardImageTitle=this._element.querySelector(".card__title"),this._likesCount=this._element.querySelector(".card__like-counter")}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._deleteButton.addEventListener("click",(()=>this._handleDeleteCard(this._id))),this._likeButton.addEventListener("click",(()=>this._handleLikeButton(this._id))),this._cardImage.addEventListener("click",(()=>this._handleCardClick({name:this._name,src:this._link})))}isLiked(){return this._likes.some((e=>e._id===this._userId))}generateCard(){return this._setEventListeners(),this._cardImage.src=this._link,this._cardImage.alt=this._link,this._cardImageTitle.textContent=this._name,this._likesCount.textContent=this._likes.length,this._ownerId!==this._userId&&(this._deleteButton.style.display="none"),this.isLiked()&&this.handleLikeCard(this._likes),this._element}}const r=document.querySelector(".popup__input_type_name"),n=document.querySelector(".popup__input_type_job"),i=document.querySelector(".button_type_edit"),o=document.querySelector(".button_type_add"),a=document.querySelector(".profile__image-overlay");class l{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popupElement=document.querySelector(e)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("button_type_close"))&&this.close()}))}}var c=class extends l{constructor(e,t){super(e),this._handleFormSubmit=t,this._popupForm=this._popupElement.querySelector(".popup__form"),this._inputs=Array.from(this._popupForm.querySelectorAll(".popup__input"))}_getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}close(){super.close(),this._popupForm.reset()}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(()=>this._handleFormSubmit(this._getInputValues())))}};const u={};var h;h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(h.formSelector)).forEach((t=>{const s=new e(h,t),r=t.getAttribute("name");u[r]=s,s.enableValidation()}));const _=new class{constructor(e){let{name:t,about:s,avatar:r,_id:n,userNameSelector:i,userAboutSelector:o,avatarSelector:a}=e;this._name=t,this._about=s,this._avatar=r,this._id=n,this._userNameElement=document.querySelector(i),this._userAboutElement=document.querySelector(o),this._avatarElement=document.querySelector(a)}getUserInfo(){return{name:this._userNameElement.textContent,about:this._userAboutElement.textContent}}setUserInfo(e){let{name:t,about:s,avatar:r}=e;this._userNameElement.textContent=t||this._name,this._userAboutElement.textContent=s||this._about,this._avatarElement.src=r||this._avatar,this._avatarElement.alt=t||this._name}}({userNameSelector:".profile__user-name",userAboutSelector:".profile__user-job",avatarSelector:".profile__image"}),d=new c(".popup_type_profile",(function(e){f.editProfile(e).then((e=>{console.log(e),_.setUserInfo(e)})),d.close()})),m=new c(".popup_type_add-card",(function(e){let{name:t,url:s}=e;const r={name:t,link:s};f.createCard(r).then((e=>{console.log(e),b.addItem(e)})),m.close()})),p=new c(".popup_type_avatar",(function(e){f.editAvatar(e).then((e=>{console.log(e),_.setUserInfo(e),p.close()}))})),v=new class extends l{constructor(e){super(e),this._imageZoom=this._popupElement.querySelector(".popup__image"),this._imageZoomTitle=this._popupElement.querySelector(".popup__title")}open(e){let{link:t,name:s}=e;super.open(),this._imageZoom.src=t,this._imageZoom.alt="Image of ".concat(s),this._imageZoomTitle.textContent=s}}(".popup_type_zoom-card"),E=new class extends l{constructor(e){super(e)}setAction(e){this._submitHandler=e}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()}))}}(".popup_type_delete");d.setEventListeners(),m.setEventListeners(),v.setEventListeners(),E.setEventListeners(),p.setEventListeners(),i.addEventListener("click",(function(){d.open();const{name:e,about:t}=_.getUserInfo();r.value=e,n.value=t,u["form-profile"].resetValidation()}));const b=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}addItem(e){const t=this._renderer(e);this._container.prepend(t)}renderItems(e){e.forEach((e=>{this.addItem(e)}))}}({renderer:e=>{const t=new s({data:e,handleCardClick:()=>{v.open({link:e.link,name:e.name})},handleDeleteCard:e=>{E.open(),E.setAction((()=>{f.deleteCard(e).then((e=>{console.log(e),t.removeCardFromDOM(),E.close()}))}))},handleLikeButton:e=>{t.isLiked()?f.unlikeCard(e).then((e=>{console.log(e),t.handleLikeCard(e.likes)})):f.likeCard(e).then((e=>{console.log(e),t.handleLikeCard(e.likes)}))}},"#card",C);return t.generateCard()}},".cards__card-grid");o.addEventListener("click",(function(){m.open(),u["form-add-card"].resetValidation()}));const f=new class{constructor(e){let{baseUrl:t,headers:s}=e;var r,n;n=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))).catch((e=>{console.log("Error: ".concat(e))})),(r="_customFetch")in this?Object.defineProperty(this,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[r]=n,this._baseUrl=t,this._headers=s}getUserInfo(){return this._customFetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}getInitialCards(){return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers})}createCard(e){return this._customFetch("".concat(this._baseUrl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify(e)})}deleteCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"})}editProfile(e){let{name:t,about:s}=e;return this._customFetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:s})})}editAvatar(e){let{avatar:t}=e;return this._customFetch("".concat(this._baseUrl,"/users/me/avatar"),{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:t})})}likeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"PUT"})}unlikeCard(e){return this._customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:"DELETE"})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"0d380c06-5bf9-4f9e-b38f-f8e4b1728003","Content-Type":"application/json"}});let C;Promise.all([f.getUserInfo(),f.getInitialCards()]).then((e=>{let[t,s]=e;console.log(s),C=t._id,_.setUserInfo({name:t.name,about:t.about,avatar:t.avatar,_id:t._id}),b.renderItems(s.reverse())})),a.addEventListener("click",(function(){p.open(),u["form-avatar"].resetValidation()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQWUsTUFBTUEsRUFDbkJDLFlBQVlDLEVBQVFDLEdBQ2xCQyxLQUFLQyxjQUFnQkgsRUFBT0ksYUFDNUJGLEtBQUtHLGVBQWlCTCxFQUFPTSxjQUM3QkosS0FBS0ssc0JBQXdCUCxFQUFPUSxxQkFDcENOLEtBQUtPLHFCQUF1QlQsRUFBT1Usb0JBQ25DUixLQUFLUyxpQkFBbUJYLEVBQU9ZLGdCQUMvQlYsS0FBS1csWUFBY2IsRUFBT2MsV0FDMUJaLEtBQUthLGFBQWVkLEVBQ3BCQyxLQUFLYyxXQUFhQyxNQUFNQyxLQUN0QmhCLEtBQUthLGFBQWFJLGlCQUFpQmpCLEtBQUtHLGlCQUUxQ0gsS0FBS2tCLGVBQWlCbEIsS0FBS2EsYUFBYU0sY0FDdENuQixLQUFLSyx1QkFHVGUsZ0JBQWdCQyxHQUNkLE1BQU1DLEVBQWV0QixLQUFLYSxhQUFhTSxjQUFsQixXQUNmRSxFQUFhRSxHQURFLFdBR3JCRixFQUFhRyxVQUFVQyxJQUFJekIsS0FBS1Msa0JBQ2hDYSxFQUFhSSxZQUFjTCxFQUFhTSxrQkFDeENMLEVBQWFFLFVBQVVDLElBQUl6QixLQUFLVyxhQUVsQ2lCLGdCQUFnQlAsR0FDZCxNQUFNQyxFQUFldEIsS0FBS2EsYUFBYU0sY0FBbEIsV0FDZkUsRUFBYUUsR0FERSxXQUdyQkYsRUFBYUcsVUFBVUssT0FBTzdCLEtBQUtTLGtCQUNuQ2EsRUFBYUUsVUFBVUssT0FBTzdCLEtBQUtXLGFBQ25DVyxFQUFhSSxZQUFjLEdBRTdCSSxvQkFBb0JULEdBQ2JBLEVBQWFVLFNBQVNDLE1BR3pCaEMsS0FBSzRCLGdCQUFnQlAsR0FGckJyQixLQUFLb0IsZ0JBQWdCQyxHQUt6QlksbUJBQ0UsT0FBT2pDLEtBQUtjLFdBQVdvQixNQUFNYixJQUFrQkEsRUFBYVUsU0FBU0MsUUFFdkVHLHFCQUNNbkMsS0FBS2lDLG9CQUNQakMsS0FBS2tCLGVBQWVNLFVBQVVDLElBQUl6QixLQUFLTyxzQkFDdkNQLEtBQUtrQixlQUFla0IsVUFBVyxJQUUvQnBDLEtBQUtrQixlQUFlTSxVQUFVSyxPQUFPN0IsS0FBS08sc0JBQzFDUCxLQUFLa0IsZUFBZWtCLFVBQVcsR0FHbkNDLHFCQUNFckMsS0FBS2MsV0FBV3dCLFNBQVNqQixJQUN2QkEsRUFBYWtCLGlCQUFpQixTQUFTLEtBQ3JDdkMsS0FBSzhCLG9CQUFvQlQsR0FDekJyQixLQUFLbUMsMkJBSVhLLGFBQ0V4QyxLQUFLYyxXQUFXd0IsU0FBU2pCLElBQ3ZCckIsS0FBSzRCLGdCQUFnQlAsTUFJekJvQixrQkFDRXpDLEtBQUttQyxxQkFDTG5DLEtBQUt3QyxhQUdQRSxtQkFDRTFDLEtBQUthLGFBQWEwQixpQkFBaUIsVUFBV0ksSUFDNUNBLEVBQUlDLG9CQUVONUMsS0FBS3FDLHNCLHdIQzFFTSxNQUFNUSxFQUNuQmhELFlBQVksRUFFVmlELEVBQ0FDLEdBQ0EsSUFIQSxLQUFFQyxFQUFGLGdCQUFRQyxFQUFSLGlCQUF5QkMsRUFBekIsaUJBQTJDQyxHQUczQyw4QkF1Q2tCLEtBQ2xCbkQsS0FBS29ELFNBQVN2QixTQUNkN0IsS0FBS29ELFNBQVcsUUF6Q2hCLHlCQThDZ0JDLElBQ2hCckQsS0FBS3NELE9BQVNELEVBQ2RyRCxLQUFLdUQsWUFBWTdCLFlBQWMxQixLQUFLc0QsT0FBT0UsT0FDM0N4RCxLQUFLeUQsWUFBWWpDLFVBQVVrQyxPQUFPLG9CQWhEbEMxRCxLQUFLMkQsTUFBUVgsRUFBS1ksS0FDbEI1RCxLQUFLNkQsTUFBUWIsRUFBS2MsS0FDbEI5RCxLQUFLK0QsSUFBTWYsRUFBS2UsSUFDaEIvRCxLQUFLZ0UsU0FBV2hCLEVBQUtpQixNQUFNRixJQUMzQi9ELEtBQUtrRSxRQUFVbkIsRUFDZi9DLEtBQUtzRCxPQUFTTixFQUFLbUIsTUFDbkJuRSxLQUFLb0UsY0FBZ0J0QixFQUNyQjlDLEtBQUtxRSxpQkFBbUJwQixFQUN4QmpELEtBQUtzRSxrQkFBb0JuQixFQUN6Qm5ELEtBQUt1RSxrQkFBb0JyQixFQUN6QmxELEtBQUtvRCxTQUFXcEQsS0FBS3dFLGVBQ3JCeEUsS0FBS3lELFlBQWN6RCxLQUFLb0QsU0FBU2pDLGNBQWMscUJBQy9DbkIsS0FBS3lFLGNBQWdCekUsS0FBS29ELFNBQVNqQyxjQUFjLHVCQUNqRG5CLEtBQUswRSxXQUFhMUUsS0FBS29ELFNBQVNqQyxjQUFjLGdCQUM5Q25CLEtBQUsyRSxnQkFBa0IzRSxLQUFLb0QsU0FBU2pDLGNBQWMsZ0JBQ25EbkIsS0FBS3VELFlBQWN2RCxLQUFLb0QsU0FBU2pDLGNBQWMsdUJBR2pEcUQsZUFLRSxPQUpvQkksU0FDakJ6RCxjQUFjbkIsS0FBS29FLGVBQ25CUyxRQUFRMUQsY0FBYyxTQUN0QjJELFdBQVUsR0FJZnpDLHFCQUNFckMsS0FBS3lFLGNBQWNsQyxpQkFBaUIsU0FBUyxJQUMzQ3ZDLEtBQUt1RSxrQkFBa0J2RSxLQUFLK0QsT0FFOUIvRCxLQUFLeUQsWUFBWWxCLGlCQUFpQixTQUFTLElBQ3pDdkMsS0FBS3NFLGtCQUFrQnRFLEtBQUsrRCxPQUU5Qi9ELEtBQUswRSxXQUFXbkMsaUJBQWlCLFNBQVMsSUFDeEN2QyxLQUFLcUUsaUJBQWlCLENBQUVULEtBQU01RCxLQUFLMkQsTUFBT29CLElBQUsvRSxLQUFLNkQsVUFReERtQixVQUNFLE9BQU9oRixLQUFLc0QsT0FBT3BCLE1BQU0rQyxHQUFXQSxFQUFPbEIsTUFBUS9ELEtBQUtrRSxVQVExRGdCLGVBYUUsT0FaQWxGLEtBQUtxQyxxQkFDTHJDLEtBQUswRSxXQUFXSyxJQUFNL0UsS0FBSzZELE1BQzNCN0QsS0FBSzBFLFdBQVdTLElBQU1uRixLQUFLNkQsTUFDM0I3RCxLQUFLMkUsZ0JBQWdCakQsWUFBYzFCLEtBQUsyRCxNQUN4QzNELEtBQUt1RCxZQUFZN0IsWUFBYzFCLEtBQUtzRCxPQUFPRSxPQUN2Q3hELEtBQUtnRSxXQUFhaEUsS0FBS2tFLFVBQ3pCbEUsS0FBS3lFLGNBQWNXLE1BQU1DLFFBQVUsUUFHakNyRixLQUFLZ0YsV0FDUGhGLEtBQUtzRixlQUFldEYsS0FBS3NELFFBRXBCdEQsS0FBS29ELFVDdEVULE1BQU1tQyxFQUFZWCxTQUFTekQsY0FBYywyQkFDbkNxRSxFQUFXWixTQUFTekQsY0FBYywwQkFDbENzRSxFQUFhYixTQUFTekQsY0FBYyxxQkFDcEN1RSxFQUFZZCxTQUFTekQsY0FBYyxvQkFDbkN3RSxFQUFTZixTQUFTekQsY0FBYywyQkNKOUIsTUFBTXlFLEVBQ25CL0YsWUFBWWdHLEcsVUFZT2xELElBQ0QsV0FBWkEsRUFBSW1ELEtBQ045RixLQUFLK0YsVSxFQWRrQiwwQixzQkFBQSxLLHVEQUFBLEssS0FDekIvRixLQUFLZ0csY0FBZ0JwQixTQUFTekQsY0FBYzBFLEdBRzlDSSxPQUNFakcsS0FBS2dHLGNBQWN4RSxVQUFVQyxJQUFJLGdCQUNqQ21ELFNBQVNyQyxpQkFBaUIsVUFBV3ZDLEtBQUtrRyxpQkFFNUNILFFBQ0UvRixLQUFLZ0csY0FBY3hFLFVBQVVLLE9BQU8sZ0JBQ3BDK0MsU0FBU3VCLG9CQUFvQixVQUFXbkcsS0FBS2tHLGlCQU8vQ0Usb0JBQ0VwRyxLQUFLZ0csY0FBY3pELGlCQUFpQixhQUFjSSxLQUU5Q0EsRUFBSTBELE9BQU83RSxVQUFVOEUsU0FBUyxpQkFDOUIzRCxFQUFJMEQsT0FBTzdFLFVBQVU4RSxTQUFTLHVCQUU5QnRHLEtBQUsrRixZQ1RiLElDZ0JBLEVBOUJBLGNBQTRCSCxFQUMxQi9GLFlBQVlnRyxFQUFlVSxHQUN6QkMsTUFBTVgsR0FDTjdGLEtBQUt5RyxrQkFBb0JGLEVBQ3pCdkcsS0FBSzBHLFdBQWExRyxLQUFLZ0csY0FBYzdFLGNBQWMsZ0JBQ25EbkIsS0FBSzJHLFFBQVU1RixNQUFNQyxLQUNuQmhCLEtBQUswRyxXQUFXekYsaUJBQWlCLGtCQUlyQzJGLGtCQUNFLE1BQU1DLEVBQWMsR0FJcEIsT0FIQTdHLEtBQUsyRyxRQUFRckUsU0FBU3dFLElBQ3BCRCxFQUFZQyxFQUFNbEQsTUFBUWtELEVBQU1DLFNBRTNCRixFQUdUZCxRQUNFUyxNQUFNVCxRQUNOL0YsS0FBSzBHLFdBQVdNLFFBR2xCWixvQkFDRUksTUFBTUosb0JBQ05wRyxLQUFLMEcsV0FBV25FLGlCQUFpQixVQUFVLElBQ3pDdkMsS0FBS3lHLGtCQUFrQnpHLEtBQUs0Ryx1QkNSbEMsTUFBTUssRUFBaUIsR0FFR25ILElBQUFBLEVBQUFBLEVKZkosQ0FDcEJJLGFBQWMsZUFDZEUsY0FBZSxnQkFDZkUscUJBQXNCLGlCQUN0QkUsb0JBQXFCLHlCQUNyQkUsZ0JBQWlCLDBCQUNqQkUsV0FBWSx3QklVS0csTUFBTUMsS0FBSzRELFNBQVMzRCxpQkFBaUJuQixFQUFPSSxlQUNwRG9DLFNBQVN2QyxJQUNoQixNQUFNbUgsRUFBWSxJQUFJdEgsRUFBY0UsRUFBUUMsR0FDdENvSCxFQUFXcEgsRUFBWXFILGFBQWEsUUFDMUNILEVBQWVFLEdBQVlELEVBQzNCQSxFQUFVeEUsc0JBUWQsTUFBTTJFLEVBQVcsSUNuQ0YsTUFDYnhILFlBQVksR0FRVCxJQVJTLEtBQ1YrRCxFQURVLE1BRVYwRCxFQUZVLE9BR1YzQixFQUhVLElBSVY1QixFQUpVLGlCQUtWd0QsRUFMVSxrQkFNVkMsRUFOVSxlQU9WQyxHQUNDLEVBQ0F6SCxLQUFLMkQsTUFBUUMsRUFDWDVELEtBQUswSCxPQUFTSixFQUNkdEgsS0FBSzJILFFBQVVoQyxFQUNmM0YsS0FBSytELElBQU1BLEVBQ1gvRCxLQUFLNEgsaUJBQW1CaEQsU0FBU3pELGNBQWNvRyxHQUMvQ3ZILEtBQUs2SCxrQkFBb0JqRCxTQUFTekQsY0FBY3FHLEdBQ2hEeEgsS0FBSzhILGVBQWlCbEQsU0FBU3pELGNBQWNzRyxHQUdsRE0sY0FDRSxNQUFPLENBQ0xuRSxLQUFNNUQsS0FBSzRILGlCQUFpQmxHLFlBQzVCNEYsTUFBT3RILEtBQUs2SCxrQkFBa0JuRyxhQUlsQ3NHLFlBQVksR0FBeUIsSUFBekIsS0FBRXBFLEVBQUYsTUFBUTBELEVBQVIsT0FBZTNCLEdBQVUsRUFDbkMzRixLQUFLNEgsaUJBQWlCbEcsWUFBY2tDLEdBQVE1RCxLQUFLMkQsTUFDakQzRCxLQUFLNkgsa0JBQWtCbkcsWUFBYzRGLEdBQVN0SCxLQUFLMEgsT0FDbkQxSCxLQUFLOEgsZUFBZS9DLElBQU1ZLEdBQVUzRixLQUFLMkgsUUFDekMzSCxLQUFLOEgsZUFBZTNDLElBQU12QixHQUFRNUQsS0FBSzJELFFES2IsQ0FDNUI0RCxpQkFBa0Isc0JBQ2xCQyxrQkFBbUIscUJBQ25CQyxlQUFnQixvQkFHWlEsRUFBZSxJQUFJQyxFQUN2Qix1QkFxQkYsU0FBaUNDLEdBQy9CQyxFQUFJQyxZQUFZRixHQUFVRyxNQUFNQyxJQUM5QkMsUUFBUUMsSUFBSUYsR0FDWmxCLEVBQVNXLFlBQVlPLE1BR3ZCTixFQUFhbEMsV0F4QlQyQyxFQUFlLElBQUlSLEVBQ3ZCLHdCQW1GRixZQUFnRCxJQUFmLEtBQUV0RSxFQUFGLElBQVErRSxHQUFPLEVBQzlDLE1BQU0zRixFQUFPLENBQ1hZLEtBQU1BLEVBQ05FLEtBQU02RSxHQUVSUCxFQUFJUSxXQUFXNUYsR0FBTXNGLE1BQU1DLElBQ3pCQyxRQUFRQyxJQUFJRixHQUNaTSxFQUFTQyxRQUFRUCxNQUduQkcsRUFBYTNDLFdBMUZUZ0QsRUFBYyxJQUFJYixFQUFjLHNCQW1JdEMsU0FBNEJDLEdBQzFCQyxFQUFJWSxXQUFXYixHQUFVRyxNQUFNQyxJQUM3QkMsUUFBUUMsSUFBSUYsR0FDWmxCLEVBQVNXLFlBQVlPLEdBQ3JCUSxFQUFZaEQsY0F0SVZrRCxFQUFhLElGakRuQixjQUE2QnJELEVBQzNCL0YsWUFBWWdHLEdBQ1ZXLE1BQU1YLEdBQ043RixLQUFLa0osV0FBYWxKLEtBQUtnRyxjQUFjN0UsY0FBYyxpQkFDbkRuQixLQUFLbUosZ0JBQWtCbkosS0FBS2dHLGNBQWM3RSxjQUFjLGlCQUcxRDhFLEtBQUssR0FBZ0IsSUFBaEIsS0FBRW5DLEVBQUYsS0FBUUYsR0FBUSxFQUNuQjRDLE1BQU1QLE9BQ05qRyxLQUFLa0osV0FBV25FLElBQU1qQixFQUN0QjlELEtBQUtrSixXQUFXL0QsSUFBaEIsbUJBQWtDdkIsR0FDbEM1RCxLQUFLbUosZ0JBQWdCekgsWUFBY2tDLElFc0NELHlCQUNoQ3dGLEVBQWMsSUVsRHBCLGNBQThCeEQsRUFDNUIvRixZQUFZZ0csR0FDVlcsTUFBTVgsR0FFUndELFVBQVVDLEdBQ1J0SixLQUFLdUosZUFBaUJELEVBRXhCbEQsb0JBQ0VJLE1BQU1KLG9CQUNOcEcsS0FBS2dHLGNBQWN6RCxpQkFBaUIsVUFBV0ksSUFDN0NBLEVBQUlDLGlCQUNKNUMsS0FBS3VKLHNCRnVDNkIsc0JBSXhDdEIsRUFBYTdCLG9CQUNic0MsRUFBYXRDLG9CQUNiNkMsRUFBVzdDLG9CQUNYZ0QsRUFBWWhELG9CQUNaMkMsRUFBWTNDLG9CQXFCWlgsRUFBV2xELGlCQUFpQixTQVI1QixXQUNFMEYsRUFBYWhDLE9BQ2IsTUFBTSxLQUFFckMsRUFBRixNQUFRMEQsR0FBVUQsRUFBU1UsY0FDakN4QyxFQUFVd0IsTUFBUW5ELEVBQ2xCNEIsRUFBU3VCLE1BQVFPLEVBQ2pCTCxFQUFlLGdCQUFnQnhFLHFCQU9qQyxNQUFNb0csRUFBVyxJR3BGRixNQUNiaEosWUFBWSxFQUFjMkosR0FBbUIsSUFBakMsU0FBRUMsR0FBK0IsRUFDM0N6SixLQUFLMEosVUFBWUQsRUFDakJ6SixLQUFLMkosV0FBYS9FLFNBQVN6RCxjQUFjcUksR0FHM0NWLFFBQVFjLEdBQ04sTUFBTUMsRUFBTzdKLEtBQUswSixVQUFVRSxHQUM1QjVKLEtBQUsySixXQUFXRyxRQUFRRCxHQUcxQkUsWUFBWUMsR0FDVkEsRUFBTTFILFNBQVNzSCxJQUNiNUosS0FBSzhJLFFBQVFjLFFId0VqQixDQUNFSCxTQUFXekcsSUFDVCxNQUFNNkcsRUFBTyxJQUFJaEgsRUFDZixDQUNFRyxLQUFBQSxFQUNBQyxnQkFBaUIsS0FDZmdHLEVBQVdoRCxLQUFLLENBQUVuQyxLQUFNZCxFQUFLYyxLQUFNRixLQUFNWixFQUFLWSxRQUVoRFYsaUJBQW1CM0IsSUFDakI2SCxFQUFZbkQsT0FDWm1ELEVBQVlDLFdBQVUsS0FDcEJqQixFQUFJNkIsV0FBVzFJLEdBQUkrRyxNQUFNQyxJQUN2QkMsUUFBUUMsSUFBSUYsR0FDWnNCLEVBQUtLLG9CQUNMZCxFQUFZckQsZUFJbEI1QyxpQkFBbUI1QixJQUNNc0ksRUFBSzdFLFVBRTFCb0QsRUFBSStCLFdBQVc1SSxHQUFJK0csTUFBTUMsSUFDdkJDLFFBQVFDLElBQUlGLEdBQ1pzQixFQUFLdkUsZUFBZWlELEVBQUlwRSxVQUcxQmlFLEVBQUlnQyxTQUFTN0ksR0FBSStHLE1BQU1DLElBQ3JCQyxRQUFRQyxJQUFJRixHQUNac0IsRUFBS3ZFLGVBQWVpRCxFQUFJcEUsWUFLaEMsUUFDQXBCLEdBRUYsT0FBTzhHLEVBQUszRSxpQkFHaEIscUJBcUJGUSxFQUFVbkQsaUJBQWlCLFNBSjNCLFdBQ0VtRyxFQUFhekMsT0FDYmdCLEVBQWUsaUJBQWlCeEUscUJBTWxDLE1BQU0yRixFQUFNLElJckpHLE1BQ2J2SSxZQUFZLEdBQXNCLElBQXRCLFFBQUV3SyxFQUFTQyxRQUFBQSxHQUFXLEUsVUFJbkIsQ0FBQzNCLEVBQUsyQixJQUNaQyxNQUFNNUIsRUFBSzJCLEdBQ2ZoQyxNQUFNQyxHQUNMQSxFQUFJaUMsR0FBS2pDLEVBQUlrQyxPQUFTQyxRQUFRQyxPQUFSLGlCQUF5QnBDLEVBQUlxQyxXQUVwREMsT0FBT0MsSUFDTnRDLFFBQVFDLElBQVIsaUJBQXNCcUMsUSxFQVZNLHVCLHNCQUFBLEssdURBQUEsSyxLQUNoQzlLLEtBQUsrSyxTQUFXVixFQUNoQnJLLEtBQUtnTCxTQUFXVixFQVdsQnZDLGNBQ0UsT0FBTy9ILEtBQUtpTCxhQUFMLFVBQXFCakwsS0FBSytLLFNBQTFCLGFBQStDLENBQ3BEVCxRQUFTdEssS0FBS2dMLFdBR2xCRSxrQkFDRSxPQUFPbEwsS0FBS2lMLGFBQUwsVUFBcUJqTCxLQUFLK0ssU0FBMUIsVUFBNEMsQ0FDakRULFFBQVN0SyxLQUFLZ0wsV0FHbEJwQyxXQUFXNUYsR0FDVCxPQUFPaEQsS0FBS2lMLGFBQUwsVUFBcUJqTCxLQUFLK0ssU0FBMUIsVUFBNEMsQ0FDakRULFFBQVN0SyxLQUFLZ0wsU0FDZEcsT0FBUSxPQUNSQyxLQUFNQyxLQUFLQyxVQUFVdEksS0FHekJpSCxXQUFXc0IsR0FDVCxPQUFPdkwsS0FBS2lMLGFBQUwsVUFBcUJqTCxLQUFLK0ssU0FBMUIsa0JBQTRDUSxHQUFVLENBQzNEakIsUUFBU3RLLEtBQUtnTCxTQUNkRyxPQUFRLFdBR1o5QyxZQUFZLEdBQWlCLElBQWpCLEtBQUV6RSxFQUFGLE1BQVEwRCxHQUFTLEVBQzNCLE9BQU90SCxLQUFLaUwsYUFBTCxVQUFxQmpMLEtBQUsrSyxTQUExQixhQUErQyxDQUNwRFQsUUFBU3RLLEtBQUtnTCxTQUNkRyxPQUFRLFFBQ1JDLEtBQU1DLEtBQUtDLFVBQVUsQ0FDbkIxSCxLQUFNQSxFQUNOMEQsTUFBT0EsTUFJYjBCLFdBQVcsR0FBWSxJQUFaLE9BQUVyRCxHQUFVLEVBQ3JCLE9BQU8zRixLQUFLaUwsYUFBTCxVQUFxQmpMLEtBQUsrSyxTQUExQixvQkFBc0QsQ0FDM0RULFFBQVN0SyxLQUFLZ0wsU0FDZEcsT0FBUSxRQUNSQyxLQUFNQyxLQUFLQyxVQUFVLENBQ25CM0YsT0FBUUEsTUFJZHlFLFNBQVNtQixHQUNQLE9BQU92TCxLQUFLaUwsYUFBTCxVQUFxQmpMLEtBQUsrSyxTQUExQix3QkFBa0RRLEdBQVUsQ0FDakVqQixRQUFTdEssS0FBS2dMLFNBQ2RHLE9BQVEsUUFHWmhCLFdBQVdvQixHQUNULE9BQU92TCxLQUFLaUwsYUFBTCxVQUFxQmpMLEtBQUsrSyxTQUExQix3QkFBa0RRLEdBQVUsQ0FDakVqQixRQUFTdEssS0FBS2dMLFNBQ2RHLE9BQVEsYUpvRk0sQ0FDbEJkLFFBQVMsOENBQ1RDLFFBQVMsQ0FDUGtCLGNBQWUsdUNBQ2YsZUFBZ0Isc0JBS3BCLElBQUl6SSxFQUNKMkgsUUFBUWUsSUFBSSxDQUFDckQsRUFBSUwsY0FBZUssRUFBSThDLG9CQUFvQjVDLE1BQ3RELElBQTBCLElBQXhCSCxFQUFVdUQsR0FBYyxFQUN4QmxELFFBQVFDLElBQUlpRCxHQUNaM0ksRUFBU29GLEVBQVNwRSxJQUNsQnNELEVBQVNXLFlBQVksQ0FDbkJwRSxLQUFNdUUsRUFBU3ZFLEtBQ2YwRCxNQUFPYSxFQUFTYixNQUNoQjNCLE9BQVF3QyxFQUFTeEMsT0FDakI1QixJQUFLb0UsRUFBU3BFLE1BRWhCOEUsRUFBU2tCLFlBQVkyQixFQUFTQyxjQVVsQ2hHLEVBQU9wRCxpQkFBaUIsU0FKeEIsV0FDRXdHLEVBQVk5QyxPQUNaZ0IsRUFBZSxlQUFleEUscUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvUG9wdXBXaXRoRGVsZXRlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihjb25maWcsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fZm9ybVNlbGVjdG9yID0gY29uZmlnLmZvcm1TZWxlY3RvcjtcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gY29uZmlnLmlucHV0U2VsZWN0b3I7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3I7XG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IGNvbmZpZy5pbnB1dEVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IGNvbmZpZy5lcnJvckNsYXNzO1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XG4gICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcilcbiAgICApO1xuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgICApO1xuICB9XG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfVxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9XG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfVxuICB9XG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xuICB9XG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICBfcmVzZXRGb3JtKCkge1xuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfSk7XG4gIH1cblxuICByZXNldFZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICB0aGlzLl9yZXNldEZvcm0oKTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgeyBkYXRhLCBoYW5kbGVDYXJkQ2xpY2ssIGhhbmRsZURlbGV0ZUNhcmQsIGhhbmRsZUxpa2VCdXR0b24gfSxcbiAgICBjYXJkU2VsZWN0b3IsXG4gICAgdXNlcklkXG4gICkge1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyLl9pZDtcbiAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbiA9IGhhbmRsZUxpa2VCdXR0b247XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCA9IGhhbmRsZURlbGV0ZUNhcmQ7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5idXR0b25fdHlwZV9saWtlXCIpO1xuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5idXR0b25fdHlwZV9kZWxldGVcIik7XG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIHRoaXMuX2NhcmRJbWFnZVRpdGxlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICAgIHRoaXMuX2xpa2VzQ291bnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudGVyXCIpO1xuICB9XG5cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCh0aGlzLl9pZClcbiAgICApO1xuICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQnV0dG9uKHRoaXMuX2lkKVxuICAgICk7XG4gICAgdGhpcy5fY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKHsgbmFtZTogdGhpcy5fbmFtZSwgc3JjOiB0aGlzLl9saW5rIH0pXG4gICAgKTtcbiAgfVxuXG4gIHJlbW92ZUNhcmRGcm9tRE9NID0gKCkgPT4ge1xuICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XG4gICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gIH07XG4gIGlzTGlrZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xpa2VzLnNvbWUoKHBlcnNvbikgPT4gcGVyc29uLl9pZCA9PT0gdGhpcy5fdXNlcklkKTtcbiAgfVxuICBoYW5kbGVMaWtlQ2FyZCA9IChuZXdMaWtlcykgPT4ge1xuICAgIHRoaXMuX2xpa2VzID0gbmV3TGlrZXM7XG4gICAgdGhpcy5fbGlrZXNDb3VudC50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJidXR0b25fYWN0aXZlXCIpO1xuICB9O1xuXG4gIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2NhcmRJbWFnZVRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9saWtlc0NvdW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xuICAgIGlmICh0aGlzLl9vd25lcklkICE9PSB0aGlzLl91c2VySWQpIHtcbiAgICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNMaWtlZCgpKSB7XG4gICAgICB0aGlzLmhhbmRsZUxpa2VDYXJkKHRoaXMuX2xpa2VzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF90eXBlX25hbWVcIik7XG5leHBvcnQgY29uc3Qgam9iSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF90eXBlX2pvYlwiKTtcbmV4cG9ydCBjb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5idXR0b25fdHlwZV9lZGl0XCIpO1xuZXhwb3J0IGNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnV0dG9uX3R5cGVfYWRkXCIpO1xuZXhwb3J0IGNvbnN0IGF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2Utb3ZlcmxheVwiKTtcblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcInBvcHVwX19lcnJvcl92aXNpYmxlXCIsXG59O1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuZWRcIikgfHxcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJidXR0b25fdHlwZV9jbG9zZVwiKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5jbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2ltYWdlWm9vbSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZVwiKTtcbiAgICB0aGlzLl9pbWFnZVpvb21UaXRsZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX190aXRsZVwiKTtcbiAgfVxuXG4gIG9wZW4oeyBsaW5rLCBuYW1lIH0pIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICAgdGhpcy5faW1hZ2Vab29tLnNyYyA9IGxpbms7XG4gICAgdGhpcy5faW1hZ2Vab29tLmFsdCA9IGBJbWFnZSBvZiAke25hbWV9YDtcbiAgICB0aGlzLl9pbWFnZVpvb21UaXRsZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEltYWdlO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5jbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG4gICAgdGhpcy5faW5wdXRzID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX3BvcHVwRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKVxuICAgICk7XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgc3VwZXIuY2xvc2UoKTtcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSlcbiAgICApO1xuICB9XG59XG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhGb3JtO1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IENhcmQgZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQge1xuICBuYW1lSW5wdXQsXG4gIGpvYklucHV0LFxuICBlZGl0QnV0dG9uLFxuICBhZGRCdXR0b24sXG4gIGF2YXRhcixcbiAgY29uZmlnLFxufSBmcm9tIFwiLi4vc2NyaXB0cy91dGlscy9jb25zdGFudHMuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhEZWxldGUgZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhEZWxldGUuanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3NjcmlwdHMvY29tcG9uZW50cy9BcGkuanNcIjtcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gZm9ybSB2YWxpZGF0aW9ucyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0ge307XG5cbmNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBjb25zdCB2YWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIGZvcm1FbGVtZW50KTtcbiAgICBjb25zdCBmb3JtTmFtZSA9IGZvcm1FbGVtZW50LmdldEF0dHJpYnV0ZShcIm5hbWVcIik7XG4gICAgZm9ybVZhbGlkYXRvcnNbZm9ybU5hbWVdID0gdmFsaWRhdG9yO1xuICAgIHZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG4gIH0pO1xufTtcblxuZW5hYmxlVmFsaWRhdGlvbihjb25maWcpO1xuXG4vKiAtLS0tLS0tLS0tLS0tIG5ldyBjbGFzc2VzJyBpbnN0YW5jZXMgd2l0aCBuZWNlc3Nhcnkgc2VsZWN0b3JzIC0tLS0tLS0tLS0tLSAqL1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIHVzZXJOYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX3VzZXItbmFtZVwiLFxuICB1c2VyQWJvdXRTZWxlY3RvcjogXCIucHJvZmlsZV9fdXNlci1qb2JcIixcbiAgYXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2ltYWdlXCIsXG59KTtcblxuY29uc3QgcHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiLFxuICBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdFxuKTtcbmNvbnN0IGFkZENhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBcIi5wb3B1cF90eXBlX2FkZC1jYXJkXCIsXG4gIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0XG4pO1xuY29uc3QgYXZhdGFyUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cF90eXBlX2F2YXRhclwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cF90eXBlX3pvb20tY2FyZFwiKTtcbmNvbnN0IGRlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aERlbGV0ZShcIi5wb3B1cF90eXBlX2RlbGV0ZVwiKTtcblxuLyogLS0gZW5hYmxlIGluaGVyaXRlZCBldmVudGxpc3RlbmVycyBvbiBpbnN0YW5jZXMgZnJvbSBwYXJlbnQgUG9wdXAgY2xhc3MgLS0gKi9cblxucHJvZmlsZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hZGRDYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmRlbGV0ZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hdmF0YXJQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gZWRpdGluZyB0aGUgcHJvZmlsZSBibG9jayAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCh1c2VyRGF0YSkge1xuICBhcGkuZWRpdFByb2ZpbGUodXNlckRhdGEpLnRoZW4oKHJlcykgPT4ge1xuICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKTtcbiAgfSk7XG5cbiAgcHJvZmlsZVBvcHVwLmNsb3NlKCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRCdXR0b24oKSB7XG4gIHByb2ZpbGVQb3B1cC5vcGVuKCk7XG4gIGNvbnN0IHsgbmFtZSwgYWJvdXQgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IG5hbWU7XG4gIGpvYklucHV0LnZhbHVlID0gYWJvdXQ7XG4gIGZvcm1WYWxpZGF0b3JzW1wiZm9ybS1wcm9maWxlXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xufVxuXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVFZGl0QnV0dG9uKTtcblxuLyogLS0tLS0tIHVzaW5nIG5ldyBpbnN0YW5jZSBvZiBTZWN0aW9uIGNsYXNzIHRvIGRpc3BsYXkgaW5pdGlhbCBjYXJkcyAtLS0tLS0gKi9cblxuY29uc3QgY2FyZExpc3QgPSBuZXcgU2VjdGlvbihcbiAge1xuICAgIHJlbmRlcmVyOiAoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxuICAgICAgICB7XG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBoYW5kbGVDYXJkQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgICAgIGltYWdlUG9wdXAub3Blbih7IGxpbms6IGRhdGEubGluaywgbmFtZTogZGF0YS5uYW1lIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaGFuZGxlRGVsZXRlQ2FyZDogKGlkKSA9PiB7XG4gICAgICAgICAgICBkZWxldGVQb3B1cC5vcGVuKCk7XG4gICAgICAgICAgICBkZWxldGVQb3B1cC5zZXRBY3Rpb24oKCkgPT4ge1xuICAgICAgICAgICAgICBhcGkuZGVsZXRlQ2FyZChpZCkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgICAgICAgICBjYXJkLnJlbW92ZUNhcmRGcm9tRE9NKCk7XG4gICAgICAgICAgICAgICAgZGVsZXRlUG9wdXAuY2xvc2UoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhhbmRsZUxpa2VCdXR0b246IChpZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXNBbHJlYWR5bGlrZWQgPSBjYXJkLmlzTGlrZWQoKTtcbiAgICAgICAgICAgIGlmIChpc0FscmVhZHlsaWtlZCkge1xuICAgICAgICAgICAgICBhcGkudW5saWtlQ2FyZChpZCkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgICAgICAgICBjYXJkLmhhbmRsZUxpa2VDYXJkKHJlcy5saWtlcyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYXBpLmxpa2VDYXJkKGlkKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgICAgICAgIGNhcmQuaGFuZGxlTGlrZUNhcmQocmVzLmxpa2VzKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCIjY2FyZFwiLFxuICAgICAgICB1c2VySWRcbiAgICAgICk7XG4gICAgICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcbiAgICB9LFxuICB9LFxuICBcIi5jYXJkc19fY2FyZC1ncmlkXCJcbik7XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBhZGRpbmcgbmV3IGNhcmQgYmxvY2sgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZEZvcm1TdWJtaXQoeyBuYW1lLCB1cmwgfSkge1xuICBjb25zdCBkYXRhID0ge1xuICAgIG5hbWU6IG5hbWUsXG4gICAgbGluazogdXJsLFxuICB9O1xuICBhcGkuY3JlYXRlQ2FyZChkYXRhKS50aGVuKChyZXMpID0+IHtcbiAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgIGNhcmRMaXN0LmFkZEl0ZW0ocmVzKTtcbiAgfSk7XG5cbiAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XG59XG5mdW5jdGlvbiBoYW5kbGVBZGRCdXR0b24oKSB7XG4gIGFkZENhcmRQb3B1cC5vcGVuKCk7XG4gIGZvcm1WYWxpZGF0b3JzW1wiZm9ybS1hZGQtY2FyZFwiXS5yZXNldFZhbGlkYXRpb24oKTtcbn1cbmFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlQWRkQnV0dG9uKTtcblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGludm9raW5nIEFwaSBpbnN0YW5jZSB3b3RoIHZhbGlkIHRva2VuIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiMGQzODBjMDYtNWJmOS00ZjllLWIzOGYtZjhlNGIxNzI4MDAzXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHBvcHVsYXRpbmcgcGFnZSB3aXRoICBpbml0aWFsIGRhdGEgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbmxldCB1c2VySWQ7XG5Qcm9taXNlLmFsbChbYXBpLmdldFVzZXJJbmZvKCksIGFwaS5nZXRJbml0aWFsQ2FyZHMoKV0pLnRoZW4oXG4gIChbdXNlckRhdGEsIGNhcmREYXRhXSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGNhcmREYXRhKTtcbiAgICB1c2VySWQgPSB1c2VyRGF0YS5faWQ7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xuICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgIGFib3V0OiB1c2VyRGF0YS5hYm91dCxcbiAgICAgIGF2YXRhcjogdXNlckRhdGEuYXZhdGFyLFxuICAgICAgX2lkOiB1c2VyRGF0YS5faWQsXG4gICAgfSk7XG4gICAgY2FyZExpc3QucmVuZGVySXRlbXMoY2FyZERhdGEucmV2ZXJzZSgpKTtcbiAgfVxuKTtcblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHVwZGF0aW5nIGF2YXRhciAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJDbGljaygpIHtcbiAgYXZhdGFyUG9wdXAub3BlbigpO1xuICBmb3JtVmFsaWRhdG9yc1tcImZvcm0tYXZhdGFyXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xufVxuYXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVBdmF0YXJDbGljayk7XG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQodXNlckRhdGEpIHtcbiAgYXBpLmVkaXRBdmF0YXIodXNlckRhdGEpLnRoZW4oKHJlcykgPT4ge1xuICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKTtcbiAgICBhdmF0YXJQb3B1cC5jbG9zZSgpO1xuICB9KTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3Ioe1xuICAgIG5hbWUsXG4gICAgYWJvdXQsXG4gICAgYXZhdGFyLFxuICAgIF9pZCxcbiAgICB1c2VyTmFtZVNlbGVjdG9yLFxuICAgIHVzZXJBYm91dFNlbGVjdG9yLFxuICAgIGF2YXRhclNlbGVjdG9yLFxuICB9KSB7XG4gICAgKHRoaXMuX25hbWUgPSBuYW1lKSxcbiAgICAgICh0aGlzLl9hYm91dCA9IGFib3V0KSxcbiAgICAgICh0aGlzLl9hdmF0YXIgPSBhdmF0YXIpLFxuICAgICAgKHRoaXMuX2lkID0gX2lkKSxcbiAgICAgICh0aGlzLl91c2VyTmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJOYW1lU2VsZWN0b3IpKSxcbiAgICAgICh0aGlzLl91c2VyQWJvdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyQWJvdXRTZWxlY3RvcikpLFxuICAgICAgKHRoaXMuX2F2YXRhckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhclNlbGVjdG9yKSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5fdXNlck5hbWVFbGVtZW50LnRleHRDb250ZW50LFxuICAgICAgYWJvdXQ6IHRoaXMuX3VzZXJBYm91dEVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgfTtcbiAgfVxuXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQsIGF2YXRhciB9KSB7XG4gICAgdGhpcy5fdXNlck5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZSB8fCB0aGlzLl9uYW1lO1xuICAgIHRoaXMuX3VzZXJBYm91dEVsZW1lbnQudGV4dENvbnRlbnQgPSBhYm91dCB8fCB0aGlzLl9hYm91dDtcbiAgICB0aGlzLl9hdmF0YXJFbGVtZW50LnNyYyA9IGF2YXRhciB8fCB0aGlzLl9hdmF0YXI7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5hbHQgPSBuYW1lIHx8IHRoaXMuX25hbWU7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuY2xhc3MgUG9wdXBXaXRoRGVsZXRlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gIH1cbiAgc2V0QWN0aW9uKGFjdGlvbikge1xuICAgIHRoaXMuX3N1Ym1pdEhhbmRsZXIgPSBhY3Rpb247XG4gIH1cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX3N1Ym1pdEhhbmRsZXIoKTtcbiAgICB9KTtcbiAgfVxufVxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoRGVsZXRlO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgYWRkSXRlbShpdGVtKSB7XG4gICAgY29uc3QgY2FyZCA9IHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGNhcmQpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoaXRlbXMpIHtcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLmFkZEl0ZW0oaXRlbSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cbiAgX2N1c3RvbUZldGNoID0gKHVybCwgaGVhZGVycykgPT4ge1xuICAgIHJldHVybiBmZXRjaCh1cmwsIGhlYWRlcnMpXG4gICAgICAudGhlbigocmVzKSA9PlxuICAgICAgICByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YClcbiAgICAgIClcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XG4gICAgICB9KTtcbiAgfTtcbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuICBjcmVhdGVDYXJkKGRhdGEpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIH0pO1xuICB9XG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgfSk7XG4gIH1cbiAgZWRpdFByb2ZpbGUoeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICBhYm91dDogYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuICBlZGl0QXZhdGFyKHsgYXZhdGFyIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXI6IGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pO1xuICB9XG4gIGxpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgIH0pO1xuICB9XG4gIHVubGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgfSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJGb3JtVmFsaWRhdG9yIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfZm9ybVNlbGVjdG9yIiwiZm9ybVNlbGVjdG9yIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwiX2lucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfYnV0dG9uRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvckVsZW1lbnQiLCJpZCIsImNsYXNzTGlzdCIsImFkZCIsInRleHRDb250ZW50IiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJzb21lIiwiX3RvZ2dsZUJ1dHRvblN0YXRlIiwiZGlzYWJsZWQiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9yZXNldEZvcm0iLCJyZXNldFZhbGlkYXRpb24iLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJDYXJkIiwiY2FyZFNlbGVjdG9yIiwidXNlcklkIiwiZGF0YSIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZURlbGV0ZUNhcmQiLCJoYW5kbGVMaWtlQnV0dG9uIiwiX2VsZW1lbnQiLCJuZXdMaWtlcyIsIl9saWtlcyIsIl9saWtlc0NvdW50IiwibGVuZ3RoIiwiX2xpa2VCdXR0b24iLCJ0b2dnbGUiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfaWQiLCJfb3duZXJJZCIsIm93bmVyIiwiX3VzZXJJZCIsImxpa2VzIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlTGlrZUJ1dHRvbiIsIl9oYW5kbGVEZWxldGVDYXJkIiwiX2dldFRlbXBsYXRlIiwiX2RlbGV0ZUJ1dHRvbiIsIl9jYXJkSW1hZ2UiLCJfY2FyZEltYWdlVGl0bGUiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJzcmMiLCJpc0xpa2VkIiwicGVyc29uIiwiZ2VuZXJhdGVDYXJkIiwiYWx0Iiwic3R5bGUiLCJkaXNwbGF5IiwiaGFuZGxlTGlrZUNhcmQiLCJuYW1lSW5wdXQiLCJqb2JJbnB1dCIsImVkaXRCdXR0b24iLCJhZGRCdXR0b24iLCJhdmF0YXIiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJrZXkiLCJjbG9zZSIsIl9wb3B1cEVsZW1lbnQiLCJvcGVuIiwiX2hhbmRsZUVzY0Nsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9wb3B1cEZvcm0iLCJfaW5wdXRzIiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwicmVzZXQiLCJmb3JtVmFsaWRhdG9ycyIsInZhbGlkYXRvciIsImZvcm1OYW1lIiwiZ2V0QXR0cmlidXRlIiwidXNlckluZm8iLCJhYm91dCIsInVzZXJOYW1lU2VsZWN0b3IiLCJ1c2VyQWJvdXRTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX2Fib3V0IiwiX2F2YXRhciIsIl91c2VyTmFtZUVsZW1lbnQiLCJfdXNlckFib3V0RWxlbWVudCIsIl9hdmF0YXJFbGVtZW50IiwiZ2V0VXNlckluZm8iLCJzZXRVc2VySW5mbyIsInByb2ZpbGVQb3B1cCIsIlBvcHVwV2l0aEZvcm0iLCJ1c2VyRGF0YSIsImFwaSIsImVkaXRQcm9maWxlIiwidGhlbiIsInJlcyIsImNvbnNvbGUiLCJsb2ciLCJhZGRDYXJkUG9wdXAiLCJ1cmwiLCJjcmVhdGVDYXJkIiwiY2FyZExpc3QiLCJhZGRJdGVtIiwiYXZhdGFyUG9wdXAiLCJlZGl0QXZhdGFyIiwiaW1hZ2VQb3B1cCIsIl9pbWFnZVpvb20iLCJfaW1hZ2Vab29tVGl0bGUiLCJkZWxldGVQb3B1cCIsInNldEFjdGlvbiIsImFjdGlvbiIsIl9zdWJtaXRIYW5kbGVyIiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJpdGVtIiwiY2FyZCIsInByZXBlbmQiLCJyZW5kZXJJdGVtcyIsIml0ZW1zIiwiZGVsZXRlQ2FyZCIsInJlbW92ZUNhcmRGcm9tRE9NIiwidW5saWtlQ2FyZCIsImxpa2VDYXJkIiwiYmFzZVVybCIsImhlYWRlcnMiLCJmZXRjaCIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJjYXRjaCIsImVyciIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY3VzdG9tRmV0Y2giLCJnZXRJbml0aWFsQ2FyZHMiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImNhcmRJZCIsImF1dGhvcml6YXRpb24iLCJhbGwiLCJjYXJkRGF0YSIsInJldmVyc2UiXSwic291cmNlUm9vdCI6IiJ9